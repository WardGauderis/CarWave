{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_styles %}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Varela+Round"/>

    <style>
        body, html {
            background-image: url('{{ url_for('main.static', filename='wave2.jpg') }}');
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            height: 100%;
        }

        h1 {
            font-family: Varela Round, sans-serif
        }

        t1 {
            background-color: white;
            font-family: Varela Round, sans-serif;
            color: black;
            display: block;
        }

        @media only screen and (max-device-width: 1024px) {
            .display-1 {
                font-size: 4rem;
            }

            .display-4 {
                font-size: 2.5rem;
            }
        }
    </style>
{% endblock %}

{% block app_content %}
    <div>
        <h1 class="text-center font-weight-bold display-1 m-4"
            style="color:#f7931e">
            CarWave
        </h1>
        <h1 class="text-center font-weight-bold display-4 m-3"
            style="color:#0e0f3b">
            surf to your destination
        </h1>
    </div>
    <div class="container">
        <form method="post" name="ride">
            <div class="form-row" style="padding:10px">
                <div class="ui-widget col-sm" style="margin:0">
                    {{ form.from_location(class="form-control", id="from", placeholder="from", style="border-radius:100px") }}
                </div>
                <div class="col-sm-auto">
                    <button id="reverse" type="button" class="btn btn-white d-none d-sm-block">&#8646</button>
                </div>
                <div class="ui-widget col-sm">
                    {{ form.to_location(class="form-control", id="to", placeholder="to", style="border-radius:100px") }}
                </div>

            </div>
            <div class="form-row" style="padding:10px">
                <div class="ui-widget col-sm">
                    {{ form.date(class="form-control", type="date", class="center form-control", style="border-radius:100px") }}
                </div>

                <div class="ui-widget col-sm">
                    {{ form.time(id="time", type="time", class="center form-control", style="border-radius:100px") }}
                </div>
            </div>
            <div class="form-row justify-content-md-center" style="padding:10px">
                {{ form.offer(value='offer', class="col-4 btn text-white form-control", placeholder="offer drive", style="border-radius:100px; background-color:#f7931e") }}
                <div class="col-2"></div>
                {{ form.find(value = 'find', class="col-4 btn text-white form-control", placeholder="find drive", style="border-radius:100px; background-color:#0e0f3b") }}
            </div>
        </form>
    </div>
{% endblock %}

{% block app_scripts %}

    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript">

        document.getElementById("date").setAttribute("min", new Date().toISOString().split("T")[0]);

        let fromOptions = [];
        let toOptions = [];

        let from = $("#from");
        let to = $("#to");

        from.val('');
        to.val('');

        let getNewRoutes = function (request, response, which) {
            request.term.replace(/\s/g, '+');
            $.ajax({
                url: "https://photon.komoot.de/api/?q=" + request.term + "&lat=51.1845557&lon=4.4199296",
                type: "GET",
                success: function (xhr) {
                    console.log(xhr);
                    let tempOptions = [];
                    for (let i = 0; i < xhr.features.length; i++) {
                        const properties = xhr.features[i].properties;
                        const lnglat = xhr.features[i].geometry.coordinates;

                        let name = properties.name + ", ";
                        if (properties.city != null) name += properties.city + ", ";
                        name += properties.country;

                        tempOptions.push(name);
                        tempOptions = [...new Set(tempOptions)];

                        if (which === 'from') fromOptions.push({name: name, latlng: [lnglat[1], lnglat[0]]});
                        else if (which === 'to') toOptions.push({name: name, latlng: [lnglat[1], lnglat[0]]});
                    }
                    response(tempOptions);
                },
                error: function (xhr) {
                    alert(xhr);
                }
            });
        };

        from.autocomplete({
            delay: 500,
            source: function (request, response) {
                getNewRoutes(request, response, 'from');
            },
        });

        to.autocomplete({
            delay: 500,
            source: function (request, response) {
                getNewRoutes(request, response, 'to');
            },
        });

        document.getElementById('reverse').onclick = function () {
            let temp = to.val();
            to.val(from.val());
            from.val(temp);
        };


    </script>
{% endblock %}